<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dark Pool Cipher</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121821;
      --accent:#67e8f9;
      --accent-2:#a78bfa;
      --good:#34d399;
      --bad:#f87171;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --grid-size:12;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text); background:radial-gradient(circle at top, #142031, #0b0f14);
      min-height:100svh; display:flex; flex-direction:column; align-items:center; padding:18px;
    }
    header, main, footer {width:100%; max-width:1100px; text-align:center}
    h1{margin:0; font-size:28px; color:var(--accent)}
    h2{color:var(--accent-2)}
    .hidden{display:none}
    .card{background:#121821; border:1px solid #243042; border-radius:12px; padding:16px; margin:12px 0; box-shadow:0 4px 12px rgba(0,0,0,.5)}

    /* Crossword Grid */
    .board{
      display:grid; grid-template-columns: repeat(var(--grid-size),1fr); gap:8px;
      padding:20px; background:linear-gradient(135deg,#1c2738,#0e141f);
      border:2px solid #243042; border-radius:20px;
      box-shadow:0 0 25px rgba(103,232,249,.2);
    }
    .cell{
      user-select:none; display:grid; place-items:center; font-weight:800;
      background:linear-gradient(145deg,#1a2333,#0c121c);
      color:#c7d2fe; border-radius:10px; padding:10px;
      font-size:1.1rem;
      box-shadow:inset 0 2px 6px rgba(0,0,0,.6);
      transition:all .25s ease;
      cursor:pointer;
    }
    .cell:hover{
      transform:scale(1.1);
      background:linear-gradient(145deg,#243657,#121a28);
      box-shadow:0 0 15px var(--accent-2);
      color:#fff;
    }
    .cell.selected{
      outline:2px solid var(--accent);
      box-shadow:0 0 15px var(--accent),0 0 30px var(--accent-2);
      transform:scale(1.15);
      background:linear-gradient(145deg,#0f2027,#203a43,#2c5364);
      color:#fff;
    }
    .cell.correct{
      outline:2px solid var(--good);
      background:linear-gradient(145deg,#064e3b,#0f766e);
      color:#d1fae5;
      box-shadow:0 0 18px var(--good),0 0 30px rgba(52,211,153,.5);
      transform:scale(1.12);
    }
    .cell.wrong{
      outline:2px solid var(--bad);
      background:linear-gradient(145deg,#7f1d1d,#991b1b);
      color:#fee2e2;
      box-shadow:0 0 15px var(--bad),0 0 30px rgba(248,113,113,.4);
      transform:scale(1.05);
    }
    .cell[data-target="true"]{animation:breathe 4s ease-in-out infinite;}
    @keyframes breathe {50%{filter:brightness(1.3)}}

    button{margin:8px; padding:10px 16px; border-radius:8px; border:none; cursor:pointer; font-weight:600}
    button.primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff}
    button.secondary{background:#243042; color:#fff}

    /* Hint Popup */
    #hintPopup{
      position:fixed; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.6); z-index:1000;
      opacity:0; pointer-events:none; transition:opacity .3s ease;
    }
    #hintPopup.active{opacity:1; pointer-events:auto;}
    #hintPopup .content{
      background:#121821; padding:20px; border-radius:12px; border:1px solid #243042; max-width:300px;
      text-align:center;
    }

    /* End Congratulation Popup */
    #congratsPopup{
      position:fixed; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.7); z-index:2000;
      opacity:0; pointer-events:none; transition:opacity .4s ease;
    }
    #congratsPopup.active{opacity:1; pointer-events:auto;}
    #congratsPopup .content{
      background:linear-gradient(135deg,#67e8f9,#a78bfa);
      padding:30px; border-radius:20px; box-shadow:0 0 25px rgba(103,232,249,.7);
      color:#fff; text-align:center; animation:popIn .6s ease;
    }
    #congratsPopup h2{font-size:36px; margin:0; margin-bottom:10px; text-shadow:0 0 12px #000;}
    @keyframes popIn{0%{transform:scale(.5); opacity:0}100%{transform:scale(1); opacity:1}}
  </style>
</head>
<body>
  <header>
    <h1>Dark Pool Cipher</h1>
  </header>

  <main>
    <!-- Start Page -->
    <section id="startPage" class="card">
      <h2>Welcome to Dark Pool Cipher</h2>
      <p>A puzzle game where you uncover hidden trading words by spotting stable letters in a shifting grid.</p>
      <button id="goInstructions" class="primary">Start</button>
    </section>

    <!-- Instructions Page -->
    <section id="instructionsPage" class="card hidden">
      <h2>How to Play</h2>
      <ul style="text-align:left">
        <li>There are 7 hidden trading words (tickers/order types).</li>
        <li>Drag across the stable letters in a straight line (horizontal, vertical, diagonal) to highlight a word.</li>
        <li>You have <b>3 hints</b>. Each hint will reveal a hidden word.</li>
        <li>Each correct word = +10 points. Find all 7 words to win!</li>
      </ul>
      <h2>Rules & Regulations</h2>
      <ul style="text-align:left">
        <li>Do not refresh the page during the game.</li>
        <li>Each attempt will be counted once you release your drag.</li>
        <li>Hints are limited and cannot be regained once used.</li>
        <li>Final score will be displayed after completing all words.</li>
        <li>Be fairâ€”no external help should be taken.</li>
      </ul>
      <button id="playBtn" class="primary">Play Game</button>
    </section>

    <!-- Game Area -->
    <section id="gameArea" class="hidden">
      <div class="card">
        <span id="status">Find all 7 hidden words</span><br>
        <span id="attempts">Attempts: 0</span> | 
        <span id="hints">Hints left: 3</span> | 
        <span id="points">Points: 0</span>
      </div>
      <div class="board" id="board"></div>
      <button id="hintBtn" class="secondary">Use Hint</button>
    </section>

    <!-- End Screen -->
    <section id="endScreen" class="card hidden">
      <h2>ðŸŽ‰ Congratulations! ðŸŽ‰</h2>
      <p>You found all 7 words!</p>
      <p id="finalScore"></p>
      <button id="restartBtn" class="primary">Play Again</button>
    </section>
  </main>

  <!-- Hint Popup -->
  <div id="hintPopup">
    <div class="content">
      <h3>Hint</h3>
      <p id="hintText"></p>
      <button id="closeHint" class="primary">Close</button>
    </div>
  </div>

  <!-- Beautiful Congrats Popup -->
  <div id="congratsPopup">
    <div class="content">
      <h2>ðŸŒŸ Congratulations! ðŸŒŸ</h2>
      <p>You mastered the Dark Pool Cipher Puzzle!</p>
      <button id="closeCongrats" class="primary">Close</button>
    </div>
  </div>

  <footer>
    <small>Dark Pool Cipher Puzzle</small>
  </footer>

  <script>
    const SHUFFLE_INTERVAL = 5000;

    const boardEl=document.getElementById('board');
    const startPage=document.getElementById('startPage');
    const instructionsPage=document.getElementById('instructionsPage');
    const gameArea=document.getElementById('gameArea');
    const endScreen=document.getElementById('endScreen');
    const attemptsEl=document.getElementById('attempts');
    const hintsEl=document.getElementById('hints');
    const pointsEl=document.getElementById('points');
    const finalScore=document.getElementById('finalScore');

    const goInstructions=document.getElementById('goInstructions');
    const playBtn=document.getElementById('playBtn');
    const restartBtn=document.getElementById('restartBtn');
    const hintBtn=document.getElementById('hintBtn');
    const hintPopup=document.getElementById('hintPopup');
    const hintText=document.getElementById('hintText');
    const closeHint=document.getElementById('closeHint');
    const congratsPopup=document.getElementById('congratsPopup');
    const closeCongrats=document.getElementById('closeCongrats');

    const WORDS=['BUY','GOOD','SELL','TESLA','NVIDIA','LIMIT','DARK','IOC','VWAP','AMZN','META','FORK','TWAP'];
    let found=0, attempts=0, hints=3, points=0;
    let GRID=12, targetWords=[];
    let letters=[];
    let dragging=false, selected=[];
    let foundWords=new Set();
    let shuffleTimer=null;

    function rand(n){return Math.floor(Math.random()*n)}
    const A='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    function randLetter(){return A[rand(A.length)]}

    function buildBoard(){
      document.documentElement.style.setProperty('--grid-size', GRID);
      boardEl.innerHTML='';
      letters=[];
      for(let r=0;r<GRID;r++){
        const row=[];
        for(let c=0;c<GRID;c++){
          const el=document.createElement('div');
          el.className='cell';
          el.textContent=randLetter();
          el.dataset.r=r; el.dataset.c=c;
          boardEl.appendChild(el);
          row.push({r,c,el,ch:el.textContent,target:false});
        }
        letters.push(row);
      }
    }

    function placeWord(word){
      const dirs=[[0,1],[1,0],[1,1],[-1,1]];
      for(let tries=0;tries<200;tries++){
        const dir=dirs[rand(dirs.length)];
        const sr=rand(GRID), sc=rand(GRID);
        const er=sr+dir[0]*(word.length-1), ec=sc+dir[1]*(word.length-1);
        if(er<0||er>=GRID||ec<0||ec>=GRID) continue;
        for(let i=0;i<word.length;i++){
          const r=sr+dir[0]*i, c=sc+dir[1]*i;
          letters[r][c].ch=word[i];
          letters[r][c].el.textContent=word[i];
          letters[r][c].target=true;
        }
        return true;
      }
      return false;
    }

    function shuffleBoard(){
      for(let r=0;r<GRID;r++){
        for(let c=0;c<GRID;c++){
          if(!letters[r][c].target){ 
            letters[r][c].ch=randLetter();
            letters[r][c].el.textContent=letters[r][c].ch;
          }
        }
      }
    }

    function startGame(){
      found=0; attempts=0; hints=3; points=0; foundWords.clear(); targetWords=[];
      attemptsEl.textContent='Attempts: 0';
      hintsEl.textContent='Hints left: 3';
      pointsEl.textContent='Points: 0';
      startPage.classList.add('hidden');
      instructionsPage.classList.add('hidden');
      endScreen.classList.add('hidden');
      gameArea.classList.remove('hidden');
      hintPopup.classList.remove('active');
      congratsPopup.classList.remove('active');

      buildBoard();
      const chosen=[...WORDS].sort(()=>Math.random()-0.5).slice(0,7);
      for(const w of chosen){placeWord(w); targetWords.push(w)}

      if(shuffleTimer) clearInterval(shuffleTimer);
      shuffleTimer=setInterval(shuffleBoard, SHUFFLE_INTERVAL);
    }

    function useHint(){
      if(hints<=0) return; 
      hints--; 
      hintsEl.textContent='Hints left: '+hints;

      const remaining=targetWords.filter(w=>!foundWords.has(w));
      if(remaining.length===0) return;

      const word=remaining[rand(remaining.length)];
      const hintOptions=[
        `One of the words is "${word}"`,
        `Look for the word "${word}"`,
        `Hidden word revealed: "${word}"`
      ];
      hintText.textContent=hintOptions[rand(hintOptions.length)];
      hintPopup.classList.add('active');
    }

    function finishGame(){
      clearInterval(shuffleTimer);
      gameArea.classList.add('hidden');
      endScreen.classList.remove('hidden');
      finalScore.textContent=`Your Final Score: ${points} points`;
      congratsPopup.classList.add('active');
    }

    goInstructions.addEventListener('click', ()=>{
      startPage.classList.add('hidden');
      instructionsPage.classList.remove('hidden');
      hintPopup.classList.remove('active');
    });

    playBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', ()=>{
      endScreen.classList.add('hidden');
      startPage.classList.remove('hidden');
      hintPopup.classList.remove('active');
      congratsPopup.classList.remove('active');
    });

    hintBtn.addEventListener('click', useHint);
    closeHint.addEventListener('click', ()=>{hintPopup.classList.remove('active');});
    closeCongrats.addEventListener('click', ()=>{congratsPopup.classList.remove('active');});

    boardEl.addEventListener('mousedown', e=>{
      if(e.target.classList.contains('cell')){
        dragging=true; selected=[e.target];
        e.target.classList.add('selected');
      }
    });
    boardEl.addEventListener('mouseover', e=>{
      if(dragging && e.target.classList.contains('cell') && !selected.includes(e.target)){
        selected.push(e.target);
        e.target.classList.add('selected');
      }
    });
    document.addEventListener('mouseup', ()=>{
      if(dragging){
        dragging=false;
        attempts++; attemptsEl.textContent='Attempts: '+attempts;

        const word=selected.map(c=>c.textContent).join('');
        if(targetWords.includes(word) && !foundWords.has(word)){
          found++; foundWords.add(word);
          points+=10; pointsEl.textContent='Points: '+points;
          selected.forEach(c=>c.classList.add('correct'));
          if(found>=7) finishGame();
        }else{
          selected.forEach(c=>c.classList.add('wrong'));
        }

        setTimeout(()=>{
          selected.forEach(c=>{
            c.classList.remove('selected','wrong');
          });
          selected=[];
        },600);
      }
    });

    hintPopup.classList.remove('active');
  </script>
</body>
</html>
